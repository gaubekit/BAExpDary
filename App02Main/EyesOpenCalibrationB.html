{% extends "global/Page.html" %}

{% block title %}Eyes Open Calibration{% endblock %}

{% block content %}

<style>
  .my-box {
    border: 1px solid #ccc;
    padding: 40px 20px;
    background-color: #f9f9f9;
    max-width: 800px;
    margin: 50px auto;
    text-align: center;
    font-family: sans-serif;
  }

  #xContainer {
    display: none;           /* initially hidden */
    margin-bottom: 20px;
  }

  #screen {
    font-size: 200px;       /* very large font like CCPT */
    font-weight: bold;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 300px;
    user-select: none;
  }

  #screen img.stimulus-img {
    width: 40%;
    margin-top: 20px;
  }

  .instruction {
    font-size: 22px;
    color: #444;
    margin-top: 20px;
  }

  button {
    font-size: 18px;
    padding: 10px 20px;
  }
</style>

<div class="my-box">
  <!-- X container (hidden at first) -->
  <div id="xContainer">
    <div id="screen">
      <img class="stimulus-img" src="{% static 'eyes_open.png' %}" alt="Open Eyes">
    </div>
  </div>

  <!-- Intro text -->
  <div class="instruction" id="introText">
    After clicking the <b>"Start Calibration"</b>-button a cross will appear in the center of the screen for {{ C.EEG_EYES_OPEN_INBETWEEN }} seconds.<br><br>
    To calibrate the EEG, please keep your eyes open, look at this cross and avoid any movement (body, eyes, etc.) during this time.
    <br><br>
    <!-- Start Button -->
    <button id="startBtn" type="button">Start Calibration</button>
  </div>

  <!-- End text -->
  <div class="instruction" id="endText" style="display: none;">
    The calibration period is complete. You can proceed to the next page.

    <br><br>
    <!-- Next button (initially hidden) -->
    <button type="submit" id="nextBtn" style="display: none;">Next</button>
  </div>

  <!-- Hidden fields for EEG timestamps -->
  <input type="hidden" name="eeg_timestamp_eyes_open_b_start" id="eegTimestampStart">
  <input type="hidden" name="eeg_timestamp_eyes_open_b_stop" id="eegTimestampStop">


</div>

{% endblock %}

{% block scripts %}
<script>
const xContainer = document.getElementById('xContainer');
const introText = document.getElementById('introText');
const endText = document.getElementById('endText');
const startBtn = document.getElementById('startBtn');

startBtn.addEventListener('click', function () {
    // Hide start button and intro
    this.style.display = 'none';
    introText.style.display = 'none';

    // Record EEG start timestamp
    const startTimestamp = new Date().toISOString();
    document.getElementById('eegTimestampStart').value = startTimestamp;

    // Show "X" container
    xContainer.style.display = 'block';

    // After EEG_EYES_OPEN_INITIAL seconds: hide container, record stop timestamp, show end instruction + Next button
    setTimeout(function () {
        xContainer.style.display = 'none';

        const stopTimestamp = new Date().toISOString();
        document.getElementById('eegTimestampStop').value = stopTimestamp;

        endText.style.display = 'block';
        document.getElementById('nextBtn').style.display = 'inline-block';
    }, {{ C.EEG_EYES_OPEN_INBETWEEN }} * 1000);
});
</script>
{% endblock %}
